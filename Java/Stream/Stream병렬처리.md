# Stream을 공부하면서 보게 되는 병렬처리

그게 대체 뭐지?

## 멀티 스레드 Java는 멀티 스레드를 지원

동시성(Concurrency)
멀티 작업을 위해 멀티 스레드가 번갈아가며 실행하는 성질이다. 싱글 코어 CPU를 이용한 멀티 작업은 병렬적으로 실행되는 것처럼 보이지만 실제로는 동시성 작업이다.

병렬 스트림은 각각의 스레드에서 처리할 수 있도록 스트림 요소를 여러 청크로 분할한 스트림이다. 때문에 병렬 스트림을 이용하면 멀티 코어 프로세서가 각각의 청크를 처리하도록 할당이 가능해진다.

즉, 병렬처기가 멀티 스레드는 복수의 코드를 멀티코어를 사용하면서 정말 동시에 병렬적으로  처리를 하는 것이다. 

## Stream에서 병렬처리 사용법
parallelStream()을 호출하면 컬렉션에서 바로 병렬 스트림을 리턴한다.

## 병렬처리가 그럼 무조건 좋고 빠른건가요?

병렬 스트림이 항상 순차 스트림보다 빠른 것은 아니다.
병렬 스트림은 병렬화하기 위해 스트림을 재귀적으로 분할하고, 스레드를 할당하고, 최종적으로 부분 결과를 하나로 합치는 과정이 필요하기 때문에 오히려 속도가 느릴 수 있다.

## 병렬처리의 헛점(오버헤드, 박싱/언박싱, 해결방법)

병렬처리가 순차적처리 보다 성능이 느리게 나오는 경우가 있다.  
그 이유 중 하나로 '기본형 특화되지 않은 스트림을 초라할 때 수반되는 오토박싱, 언박싱 등의 오버헤드가 수반되기 때문이다.

### 오버헤드란?
오버헤드란 프로그램의 실행흐름에서 나타나는 현상중 하나로 예를 들어 , 프로그램의 실행흐름 도중에 동떨어진 위치의 코드를 실행시켜야 할 때 , 추가적으로 시간,메모리,자원이 사용되는 현상입니다.
=>박싱, 언박싱도 오버헤드라고 할 수 있다.

### 오토박싱, 언박싱이 Streamd에서 일어나는 이유  
제네릭이나 컬렉션을 사용하고 있는데 원시타입이 stream에 오면 기본형을 참조형으로 바꾸는 오토박싱이 일어난다.  
기본타입을 제네릭이나 컬렉션에서 사용하기 위해 기본타입에서 참조타입으로 박싱-> 기본형으로 되돌려 주기위해 언박싱을 해야한다.
=>오버헤드 발생

### 오토박싱/언박싱을 줄이는 방법
요소의 타입이 T인 스트림은 Stream이지만, 오토박싱/언박싱의 비효율을 줄이기 위해 데이터 소스의 요소를 기본형으로 다루는 IntStream, LongStream, DoubleStream이 제공된다.  
박싱과 언박싱은 성능을 크게 하락시키기 때문에 기본형 스트림(IntStream, LongStream, DoubleStream)을 우선 사용해야한다.  
=>강의에서  
 int[] intArray = {1, 23, 15, 15, 35, 55, 13, 1, 2}; 를 Stream에 사용할 때  
InStream intStream = Arrays.Stream(intArray);를 사용한 이유.